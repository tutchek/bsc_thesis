\section{Mozart/Oz}
\verb= $Id$ =

Mozart je implementací multiparadigmatického jazyka Oz. Oz je funkcionální jazyk, 
který má vestavìnou podporu pro vícevláknové aplikace, podporu pro paralelizaci a 
mimo jiné obsahuje také vestavìnou podporu pro øe¹ené problémù s omezujícími podmínkami. 
Jak bylo zmínìno døíve, jde o jazyk multiparadigmatický, lze v nìm tedy psát i 
imperativní programy stejnì jako logické programy (podobné prologu). Dále je mo¾né 
definovat tøídy vèetnì dìdiènosti a praocvat s od nich odvozenými objekty. Tento 
jazyk byl navr¾en pro co nejvy¹¹í variabilitu pøi pou¾ití, proto¾e programátor 
mù¾e vyu¾ít naráz kombinaci funkctionálního, logického i imperativního programování, 
OOP a dal¹í najednou. Ve standardní distribuci je dodáván jako samostatný pøekladaè, 
který vytvoøí nativní programy pro daný operacní systém. Mimo toho umí také bì¾et 
v interaktivním módu, kdy se jednotlivé bloky pøíkazù posílají pøímo kompilátoru. 
Jako IDE se pou¾ívá bì¾nì systém EMACS, se kterým je Mozart/Oz dodáván. 

Podobnì jako v jiných funkcionálních jazycích je do promìnné mo¾né pøiøadit pouze 
jednu hodnotu za dobu jejího ¾ivota. Proto má ka¾dá promìnná vedle hodnoty je¹tì 
stav. V pøípadì, ¾e má dojít k akci nad promìnnou do které není nic pøiøazeno, aè 
by to pøíkaz vy¾adoval dojde k pozastavení vlákna dokud nebude do promìnné pøiøazeno. 
To umo¾òuje provést následující program:

\begin{verbatim}
a = 5
if a > b then c = 5 else c = 6
b = 4
// V c nyní bude hodnota 5
\end{verbatim}

Jazyk obsahuje vestavìnou podporu pro paralelní výpoèty, tedy na úrovni jazyka 
je mo¾né vytváøet vlákna a synchronizaèní primitiva. Jazyk navíc podporuje pøedat 
výpoèet na jiný poèítaè skrze protokol TCP/IP. Lze tedy vyu¾ít cluster poèítaèù 
pro zrychlení nároèných výpoètù.

\subsection{Popis øe¹ièe omezujících podmínek}
Pøo øe¹ení problémù s omezujícími podmínkami obsahuje vestavìný øe¹iè problémù s 
koneènou doménou (finite domain). Pro tyto úèely se mno¾inou s koneènou doménou 
rozumí koneèná mno¾ina pøirozených èísel s nulou. Øe¹iè obsahuje omezení na nejvy¹¹í 
mo¾nou hodnotu promìnné. Výpoèetní model pro propagaci podmínek se jmenuje prostor 
(space) a je tvoøen nìkolika propagátory napojenými na constraint store. Constraint 
store obsahuje konjunkci základních podmínek, tedy podmínek ve tvaru $x=n$ nebo $x \in 
D$. Tedy mù¾e vypadat napøíklad $x = 6 \& y \in 1 ... 12 \& z = y$. Propagátory 
obsahují ostatní podmínky, tedy napøíklad $x>y$ nebo $a^2 + b^2 = c^2$. Propagátor 
pro podmínku $c$ je samostatný výpoèetní agent, který se sna¾í omezit domény promìnných, 
které jsou obsa¾ené v $c$. Øe¹ením je pak takové pøiøazení hodnot promìnným, které 
splní v¹echny podmínky dané propagátory.

\begin{example} Mìjme promìnné $X$ a $Y$ a následující podmínky: $X \in \{0..9\}$, $Y \in \{0..9\}$, $X+Y = 9$, $2X + 4Y = 24$. 
\begin{enumerate}
  \item Constraint store obsahuje: $X \in \{0..9\}$, $Y \in \{0..9\}$. Propagátory: $X+Y = 9$ a $2X + 4Y = 24$.
  \item	První propagátor nemù¾e udìlat nic, druhý ale mù¾e zmìnit constraint store tak, ¾e obsahuje  $X \in \{0..8\}, Y \in \{2..6\}$.
  \item	První propagátor nyní mù¾e zmìnit constraint store na $X \in \{3..7\}$, $Y \in \{2..6\}$.
  \item	Druhý propagátor nyní zmìní constraint strore na $X \in \{4..6\}$, $Y \in 3..4$.
  \item	První propagátor zmìní constraint store na $X \in \{5..6\}$, $Y \in \{3..4\}$
  \item	Druhý propagátor nakonec zmìní constraint store, tak ¾e obsahuje $X = 6$, $Y = 3$.
\end{enumerate}
\end{example}

Propagace mù¾e být buï intervalová nebo doménová. Zatímco intervalová propagace 
pouze mìní okraje domény, doménová také odstraòuje vnitøní hodnoty domény. Pøesto¾e 
doménová propagace vypadá jako lep¹í techhnika, pou¾ívá se spí¹e intervalová pro její 
výpoèetní jednoduchost.

Ji¾ pro jednoduché problémy ale propagace nemusí vést k výsledku. Vezmìme napøíklad 
problém: $x \neq y$, $x \neq z$, $y \neq z$, $x \in \{0..1\}$, $y \in \{0..1\}$, $z \in \{0..1\}$. 
Tento problém nelze více propagovat, v¹echny podmínky lze splnit ale ¾ádná promìnné 
není pøiøazena hodnota. V této chvíli lze pou¾ít distribuci. Problém $P$ je distribuován 
pomocí podmínky $C$, pokud vyøe¹íme nové problémy $P \cup \{\neg C\}$ a $P\{C\}$. 
Alespoò v jednom z nových problémù se buï nachází øe¹ení problému $P$ a nebo je 
problém neøe¹itelný. V na¹í reprezentaci se tohoto faktu dá vyu¾ít pro space. 
Pokud se systém dostane do stabilního stavu, kdy ¾ádná podmínka není nesplnìna a 
pøitom není mo¾né pøiøadit ¾ádné promìnné hodnotu, tak vybereme promìnnou $x$ a 
hodnotu $n$ takovou, ¾e je konzistentní se v¹emi podmínkami nad $x$. Tím získáme 
dva nové space, jeden $S \cup {x = n}$ a jeden $S \cup {x \neq n}$. Na obou space 
pak pustíme propagaci. Pokud se dostane opìt do stabilního stavu, znova distribuujeme 
a takto postupujeme a¾ do vyøe¹ení problému a nebo konstatování, ¾e je problém 
neøe¹itelný. Tato metoda je úplná, tedy pokud existuje alespoò jedno øe¹ení, 
pak budou nalezena v¹echna.

Je mo¾né volit z rùzných distribuèních strategií. Volba správné strategie mù¾e 
výraznì ovlivnit dobu výpoètu. Pro vìt¹inu problémù je dobré zvolit first-fail 
strategii, tedy volit promìnnou s nejmen¹í mo¾nou doménou. Pokud ale ¾ádná dodávaná 
distribuèní strategie nevyhovuje, je mo¾né implementovat své distribuèní strategie, 
plnì na míru problému.

Pro hledání øe¹ení optimalizaèních problémù se dají vyu¾ít dvì techniky. Naivní 
technika spoèívá v postupném zvy¹ování výsledku objektivní  funkce a následném hledání 
øe¹ení, které tomuto výsledku bude odpovídat. Pro tento postup existuje v jazyce 
konstrukce, která pøed splòováním ostatních podmínek postupnì zvy¹uje danou promìnnou. 
Tento postup v¹ak postrádá obecnost a Mozart nabízí lep¹í postup -- techniku branch and bound. 
Tato technika vy¾aduje, aby u¾ivatel sestavil porovnávací funkci. Porovnávací funkce 
jako argumenty pøijímá pøedchozí a aktuální øe¹ení problému. Funkce pak zpravidla 
zavolá objektivní funkci a porovná její výsledky. Tato technika oproti naivní výraznì 
zrychlí výpoèet. 

\subsection{Nástroje pro podporu modelování}
Mozart nabízí u¾ivateli interaktivní nástroj Explorer, který umo¾òuje prozkoumat 
strom øe¹ení vèetnì dílèích rozhodnutí, které øe¹iè bìhem výpoètu uèinil. Explorer 
je mo¾né pou¾ívat také v interaktivním módu a ruènì urèovat, které vìtve øe¹ení prozkoumat. 
 
Koleèka oznaèují uzly rozhodovacího stromu, ve kterých probìhlo rozhodnutí, kosoètverce 
oznaèují nalezení úspì¹ného øe¹ení a ètverec vìtev kde není øe¹ení. Svìtlej¹í barvou 
jsou uvedené uzly, které je mo¾né je¹tì dále expandovat. Na uvedeném obrázku tedy 
máme jedno øe¹ení, dvì neúspì¹ná øe¹ení a pìt okam¾ikù, kdy do¹lo k rozhodnutí z 
nich¾ lze je¹tì ve tøech hledat dal¹í øe¹ení. Explorer umo¾òuje také export 
nakresleného stromu ve formátu PostScript.

\subsection{Implementace benchmarkù}
Ka¾dý implemetovaný benchmark je samostatný solver. Po zavolání pøíslu¹ného 
solveru je vrácena funkce, která je posléze pøedána funkci realizující hledání 
øe¹ení. Jde buï o funkce SearchOne resp. SearchAll, které naleznou jedno nebo 
v¹echna øe¹ení problému a vrátí je v seznamu. Pro spu¹tìní exploreru a interaktivní 
hledání øe¹ení lze pak zavolat ExploreOne resp. ExploreAll.